(function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty,n=function(t,e){return function(){return t.apply(e,arguments)}};L3.DEMONSEDGE.CHARACTERS.Base=function(){function t(t,e,n,i){this.de=t,this.row=e,this.col=n,this.sprite=this.addSprite(this.de.map,this.row,this.col,i),this.de.env.scene.add(this.sprite),this.moving=new L3.DEMONSEDGE.GAME.Move(this),this.actionsPerTurn=1,this.actions=this.actionsPerTurn,this.speed=1}return t.prototype.addSprite=function(t,e,n,i){var r;return r=new L3.DEMONSEDGE.THREE.Sprite(i),r.position.setX(n*t.cell.width),r.position.setY(e*t.cell.height),r.position.setZ(t.cell.depth),r},t.prototype.moveRel=function(t,e){return console.log("Attempting move: "+t+" "+e),this.move(this.row+t*this.speed,this.col+e*this.speed)},t.prototype.move=function(t,e){var n,i,r;return!this.moving.is()&&this.actions?(this.moving.set(!0),this.row=t,this.col=e,this.actions--,n={x:this.sprite.position.x,y:this.sprite.position.y},i={x:this.de.map.getX(e),y:this.de.map.getY(t)},r=new TWEEN.Tween(n).to(i,500),r.onUpdate(function(t){return function(){return t.sprite.position.x=n.x,t.sprite.position.y=n.y}}(this)),r.onComplete(function(t){return function(){return t.moving.set(!1),console.log("Finished move: "+t.row+" "+t.col)}}(this)),r.start()):this.actions?console.warn("Can't move, already moving?"):console.warn("No actions available!")},t.prototype.turnReset=function(){return this.actions=this.actionsPerTurn,console.log(this.actions+" "+this.actionsPerTurn)},t}(),L3.DEMONSEDGE.CHARACTERS.Enemy=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(L3.DEMONSEDGE.CHARACTERS.Base),L3.DEMONSEDGE.CHARACTERS.Player=function(e){function i(t,e,r,o){this.de=t,this.row=e,this.col=r,this.onClick=n(this.onClick,this),i.__super__.constructor.call(this,this.de,this.row,this.col,o),this.actionsPerTurn=2,this.actions=this.actionsPerTurn,this.speed=2}return t(i,e),i.prototype.onClick=function(t){return console.log(t),this.createMenu()},i.prototype.createMenu=function(){return console.log("creating menu...")},i}(L3.DEMONSEDGE.CHARACTERS.Base),L3.DEMONSEDGE.DemonsEdge=function(){function t(){this.create=n(this.create,this),this.preload=n(this.preload,this),console.log("Welcome to DemonsEdge"),loadJSON("resources/config/dev/test.json",["config"],this.preload)}return t.prototype.preload=function(){var t;return console.log("Preloading ..."),this.preloader=new L3.DEMONSEDGE.THREE.Preload(function(t){return function(){return console.log("... preload finished!"),t.create()}}(this)),t={sample1:"resources/img/dev/sample1.png",enemy1:"resources/img/dev/enemy1.png"},this.preloader.loadTextures(t)},t.prototype.create=function(){return this.createConfig(config),this.createEnvironment(),this.moving=new L3.DEMONSEDGE.GAME.MoveGlobal,this.turns=new L3.DEMONSEDGE.GAME.Turn(this)},t.prototype.createConfig=function(t){var e;return RDG.Dungeon.Generate(),e=RDG.Dungeon.rooms.map(function(t){return{r:t.x,c:t.y,rows:t.w,cols:t.h}}),t.map.rooms=e,this.config=t},t.prototype.createEnvironment=function(){return this.env=new L3.DEMONSEDGE.THREE.Environment(!0,"game"),this.map=new L3.DEMONSEDGE.MAP.Map(this),this.player=new L3.DEMONSEDGE.CHARACTERS.Player(this,0,0,"sample1"),this.enemy=new L3.DEMONSEDGE.CHARACTERS.Enemy(this,1,2,"enemy1"),this.createGroups()},t.prototype.createGroups=function(){var t;return this.sg1=new L3.DEMONSEDGE.THREE.Group(this,function(){var e,n,i,r;for(i=this.map.rooms,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.sprite);return r}.call(this).concat([this.player.sprite,this.enemy.sprite])),this.sg1.translateX(0),this.sg1.translateZ(-15)},t}(),L3.DEMONSEDGE.GAME.Actions=function(){function t(){console.log("Hi :)")}return t}(),L3.DEMONSEDGE.GAME.Move=function(){function t(t){this.obj=t,this.de=this.obj.de,this.state=!1}return t.prototype.set=function(t){return this.state=t,this.state?this.de.moving.add(this):this.de.moving.remove(this)},t.prototype.is=function(){return this.state},t}(),L3.DEMONSEDGE.GAME.MoveGlobal=function(){function t(){this.objs=[]}return t.prototype.add=function(t){return this.objs.push(t)},t.prototype.remove=function(t){var e;return e=this.objs.indexOf(t),this.objs.splice(e,1)},t.prototype.is=function(){return 0===this.objs.length},t}(),L3.DEMONSEDGE.GAME.Turn=function(){function t(t){this.de=t,this.number=0,this.newTurn()}return t.prototype.advance=function(){return this.de.moving.is()?(this.moveEnemies(),this.newTurn()):console.warn("Still moving!")},t.prototype.moveEnemies=function(){var t;return t=CHAOTIVE.UTIL.Random,this.de.enemy.moveRel(t.number(1,-1),t.number(1,-1))},t.prototype.newTurn=function(){return this.de.player.turnReset(),this.de.enemy.turnReset(),this.number++,console.log("Beginning turn "+this.number)},t}(),L3.DEMONSEDGE.MAP.Map=function(){function t(t){var e;this.de=t,this.cell=this.de.config.map.cell,this.rooms=function(){var t,n,i,r;for(i=this.de.config.map.rooms,r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(new L3.DEMONSEDGE.MAP.Room(this,e));return r}.call(this)}return t.prototype.getX=function(t){var e;return e=t*this.cell.width},t.prototype.getY=function(t){var e;return e=t*this.cell.height},t}(),L3.DEMONSEDGE.MAP.Room=function(){function t(t,e){var n,i,r,o,s,h,c,E,u,a,p;for(this.map=t,this.r=e.r,this.c=e.c,this.rows=e.rows,this.cols=e.cols,this.sprite=new THREE.Object3D,this.cells=[],E=o=0,u=this.rows;u>=0?u>o:o>u;E=u>=0?++o:--o)for(n=s=0,a=this.cols;a>=0?a>s:s>a;n=a>=0?++s:--s)i=new L3.DEMONSEDGE.MAP.Cell(this.map,this.r+E,this.c+n),this.sprite.add(i.sprite),this.cells.push(i);for(this.map.de.env.scene.add(this.sprite),p=this.cells,h=0,c=p.length;c>h;h++)n=p[h],r=new THREE.EdgesHelper(n.sprite,65280),this.map.de.env.scene.add(r)}return t}(),L3.DEMONSEDGE.MAP.Cell=function(){function t(t,e,n){this.r=e,this.c=n,this.sprite=new L3.DEMONSEDGE.THREE.SHAPES.Box(t.cell.width,t.cell.height,t.cell.depth),this.sprite.position.setX(this.c*t.cell.width),this.sprite.position.setY(this.r*t.cell.height)}return t}(),L3.DEMONSEDGE.THREE.Camera=function(e){function n(t,e,i,r){n.__super__.constructor.call(this,t,e,i,r),this.translateX(0),this.translateY(-45),this.translateZ(45),this.zoom=2}return t(n,e),n}(THREE.PerspectiveCamera),L3.DEMONSEDGE.THREE.Controls=function(e){function n(t,e){n.__super__.constructor.call(this,t,e),this.enableDamping=!0,this.dampingFactor=.25,this.enableZoom=!0}return t(n,e),n}(THREE.OrbitControls),L3.DEMONSEDGE.THREE.Environment=function(){function t(t,e){this.updateRendererSize=n(this.updateRendererSize,this),this.init(t,e),this.render()}return t.prototype.init=function(t,e){var n,i;return this.container=document.getElementById(e),this.scene=new L3.DEMONSEDGE.THREE.Scene,this.camera=new L3.DEMONSEDGE.THREE.Camera,n=new THREE.AmbientLight(4473924),this.scene.add(n),i=new THREE.PointLight(16777215,1,100),this.scene.add(this.camera),this.camera.add(i),this.renderer=new THREE.WebGLRenderer({alpha:t,antialiasing:!0}),this.updateRendererSize(),this.container.appendChild(this.renderer.domElement),this.controls=new L3.DEMONSEDGE.THREE.Controls(this.camera,this.renderer.domElement),window.addEventListener("resize",this.updateRendererSize,!1)},t.prototype.render=function(){return requestAnimationFrame(function(t){return function(){return t.render()}}(this)),TWEEN.update(),this.renderer.render(this.scene,this.camera)},t.prototype.updateRendererSize=function(){var t;return t=this.container.parentNode,this.size={width:t.offsetWidth-50,height:t.offsetHeight-50},this.camera.aspect=this.size.width/this.size.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.size.width,this.size.height)},t}(),L3.DEMONSEDGE.THREE.Group=function(e){function n(t,e){var i,r,o,s;for(this.de=t,this.sprites=e,n.__super__.constructor.call(this),o=this.sprites,i=0,r=o.length;r>i;i++)s=o[i],this.add(s);this.de.env.scene.add(this)}return t(n,e),n}(THREE.Object3D),L3.DEMONSEDGE.THREE.Preload=function(){function t(t){this.manager=new THREE.LoadingManager,this.manager.onLoad=t,this.textureLoader=new THREE.TextureLoader(this.manager)}return t.prototype.loadTextures=function(t){var e,n,i;n=[];for(i in t)e=t[i],console.log(i+" ..."),n.push(this.loadTexture(i,e));return n},t.prototype.loadTexture=function(t,e){return L3.DEMONSEDGE.THREE.textures={},this.textureLoader.load(e,function(n){return console.log("... "+e),L3.DEMONSEDGE.THREE.textures[t]=n})},t}(),L3.DEMONSEDGE.THREE.Scene=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.addFromArray=function(t){var e,n,i,r;for(console.log("Adding "+t.length+" objects."),r=[],e=0,n=t.length;n>e;e++)i=t[e],r.push(this.add(i));return r},n}(THREE.Scene),L3.DEMONSEDGE.THREE.SHAPES.Box=function(){function t(t,e,n){var i,r,o;return i=new THREE.BoxGeometry(t,e,n),r=new THREE.MeshBasicMaterial({color:16711680}),o=new THREE.Mesh(i,r)}return t}(),L3.DEMONSEDGE.THREE.Sprite=function(){function t(t){var e,n,i;return i=L3.DEMONSEDGE.THREE.textures[t],e=new THREE.SpriteMaterial({map:i,color:16777215,fog:!0}),n=new THREE.Sprite(e)}return t}()}).call(this);