(function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty,n=function(t,e){return function(){return t.apply(e,arguments)}};L3.DEMONSEDGE.CHARACTERS.Base=function(){function t(t,e,n,i){this.g=t,this.row=e,this.col=n,this.sprite=this.addSprite(this.g,this.row,this.col,i),this.g.env.scene.add(this.sprite),console.log(this),this.moving=new L3.DEMONSEDGE.GAME.Move(this),this.actionsPerTurn=1,this.actions=this.actionsPerTurn,this.speed=1}return t.prototype.addSprite=function(t,e,n,i){var r;return r=new L3.DEMONSEDGE.THREE.Sprite(i),r.position.setX(n*t.map.cell.width),r.position.setY(e*t.map.cell.height),r.position.setZ(t.map.cell.depth),r},t.prototype.moveRel=function(t,e){return console.log("Attempting move: "+t+" "+e),this.move(this.row+t*this.speed,this.col+e*this.speed)},t.prototype.move=function(t,e){var n,i,r;return!this.moving.is()&&this.actions?(this.moving.set(!0),this.row=t,this.col=e,this.actions--,n={x:this.sprite.position.x,y:this.sprite.position.y},i={x:this.g.map.getX(e),y:this.g.map.getY(t)},r=new TWEEN.Tween(n).to(i,500),r.onUpdate(function(t){return function(){return t.sprite.position.x=n.x,t.sprite.position.y=n.y}}(this)),r.onComplete(function(t){return function(){return t.moving.set(!1),console.log("Finished move: "+t.row+" "+t.col)}}(this)),r.start()):this.actions?console.warn("Can't move, already moving?"):console.warn("No actions available!")},t.prototype.turnReset=function(){return this.actions=this.actionsPerTurn,console.log(this.actions+" "+this.actionsPerTurn)},t}(),L3.DEMONSEDGE.CHARACTERS.Enemy=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(L3.DEMONSEDGE.CHARACTERS.Base),L3.DEMONSEDGE.CHARACTERS.Player=function(e){function i(t,e,r,s){this.g=t,this.row=e,this.col=r,this.onClick=n(this.onClick,this),i.__super__.constructor.call(this,this.g,this.row,this.col,s),this.actionsPerTurn=2,this.actions=this.actionsPerTurn,this.speed=2}return t(i,e),i.prototype.onClick=function(t){return console.log(t),this.createMenu()},i.prototype.createMenu=function(){return console.log("creating menu...")},i}(L3.DEMONSEDGE.CHARACTERS.Base),L3.DEMONSEDGE.DemonsEdge=function(){function t(){this.create=n(this.create,this),this.preloadPixi=n(this.preloadPixi,this),this.preload=n(this.preload,this),console.log("Welcome to DemonsEdge"),loadJSON("resources/config/dev/test.json",["config"],this.preload)}return t.prototype.preload=function(){var t;return console.log("Preloading three.js..."),t=new L3.DEMONSEDGE.THREE.Preload(function(t){return function(){return console.log("... preload finished!"),t.preloadPixi()}}(this)),this.ress=t.ress,t.load({sample1:"resources/img/dev/sample1.png",enemy1:"resources/img/dev/enemy1.png"},"textures"),t.load({background:"resources/img/dev/background.png"},"imgs")},t.prototype.preloadPixi=function(){var t,e,n,i;console.log("Preloading pixi.js..."),n=PIXI.loader,e={arrow:"resources/img/dev/hud/key-board-arrow-border.png",endTurn:"resources/img/dev/hud/end-turn.png",character:"resources/img/dev/sample1.png"};for(t in e)i=e[t],console.log(t),n.add(t,i);return n.once("complete",function(t){return function(){return console.log("... preload finished!"),t.create()}}(this)),n.load()},t.prototype.create=function(){return this.createConfig(config),this.createEnvironment(),this.moving=new L3.DEMONSEDGE.GAME.MoveGlobal,this.turns=new L3.DEMONSEDGE.GAME.Turn(this)},t.prototype.createConfig=function(t){return RDG.Dungeon.Generate(),t.map.rooms=RDG.Dungeon.rooms.map(function(t){return{r:t.x,c:t.y,rows:t.w,cols:t.h}}),this.config=t},t.prototype.createEnvironment=function(){return this.hud=new L3.DEMONSEDGE.HUD.Hud(this,100,430,{view:document.getElementById("game-hud")}),this.env=new L3.DEMONSEDGE.THREE.Environment(!0,"game-scene"),this.map=new L3.DEMONSEDGE.MAP.Map(this),this.player=new L3.DEMONSEDGE.CHARACTERS.Player(this,0,0,"sample1"),this.enemy=new L3.DEMONSEDGE.CHARACTERS.Enemy(this,1,2,"enemy1"),this.createGroups()},t.prototype.createGroups=function(){var t;return this.sg1=new L3.DEMONSEDGE.THREE.Group(this,function(){var e,n,i,r;for(i=this.map.rooms,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.sprite);return r}.call(this).concat([this.player.sprite,this.enemy.sprite])),this.sg1.translateX(0),this.sg1.translateZ(-15)},t}(),L3.DEMONSEDGE.GAME.Actions=function(){function t(){console.log("Hi :)")}return t}(),L3.DEMONSEDGE.GAME.Move=function(){function t(t){this.obj=t,this.g=this.obj.g,this.state=!1}return t.prototype.set=function(t){return this.state=t,this.state?this.g.moving.add(this):this.g.moving.remove(this)},t.prototype.is=function(){return this.state},t}(),L3.DEMONSEDGE.GAME.MoveGlobal=function(){function t(){this.objs=[]}return t.prototype.add=function(t){return this.objs.push(t)},t.prototype.remove=function(t){var e;return e=this.objs.indexOf(t),this.objs.splice(e,1)},t.prototype.is=function(){return 0===this.objs.length},t}(),L3.DEMONSEDGE.GAME.Turn=function(){function t(t){this.de=t,this.number=0,this.newTurn()}return t.prototype.advance=function(){return this.de.moving.is()?(this.moveEnemies(),this.newTurn()):console.warn("Still moving!")},t.prototype.moveEnemies=function(){var t;return t=CHAOTIVE.UTIL.Random,this.de.enemy.moveRel(t.number(1,-1),t.number(1,-1))},t.prototype.newTurn=function(){return this.de.player.turnReset(),this.de.enemy.turnReset(),this.number++,console.log("Beginning turn "+this.number)},t}(),L3.DEMONSEDGE.GUI.Button=function(){function t(){}return t}(),L3.DEMONSEDGE.HUD.BUTTONS.Arrow=function(e){function n(t,e,n,i){this.parent=t,this.direction=i,this.sprite=new L3.DEMONSEDGE.PIXI.Sprite("arrow"),this.sprite.width=25,this.sprite.height=25,this.sprite.position.x=e,this.sprite.position.y=n,this.sprite.rotate(this.direction),this.sprite.interactive=!0,this.sprite.on("mousedown",function(t){return function(){return t.action(t.direction)}}(this)),this.sprite.on("touchstart",function(t){return function(){return t.action(t.direction)}}(this)),this.parent.addChild(this.sprite)}return t(n,e),n.prototype.action=function(t){switch(t){case"left":return L3.de.player.moveRel(0,-1);case"right":return L3.de.player.moveRel(0,1);case"up":return L3.de.player.moveRel(1,0);case"down":return L3.de.player.moveRel(-1,0)}},n}(L3.DEMONSEDGE.GUI.Button),L3.DEMONSEDGE.HUD.BUTTONS.EndTurn=function(e){function n(t,e,n){this.parent=t,this.sprite=new L3.DEMONSEDGE.PIXI.Sprite("endTurn"),this.sprite.width=90,this.sprite.height=60,this.sprite.position.x=e,this.sprite.position.y=n,this.sprite.interactive=!0,this.sprite.on("mousedown",function(t){return function(){return t.action()}}(this)),this.sprite.on("touchstart",function(t){return function(){return t.action()}}(this)),this.parent.addChild(this.sprite)}return t(n,e),n.prototype.action=function(){return L3.de.turns.advance()},n}(L3.DEMONSEDGE.GUI.Button),L3.DEMONSEDGE.HUD.Hud=function(){function t(t,e,i,r){this.g=t,null==r&&(r={}),this.animate=n(this.animate,this),r.transparent=!0,this.renderer=new PIXI.CanvasRenderer(e,i,r),this.renderer.autoResize=!0,this.stage=new PIXI.Container,this.create(),this.animate()}return t.prototype.create=function(){return this.graphics=new PIXI.Graphics,this.graphics.lineStyle(1,16711680,1),this.graphics.beginFill(3869451,.25),this.graphics.drawRoundedRect(0,0,this.renderer.width,this.renderer.height,5),this.graphics.endFill(),this.stage.addChild(this.graphics),this.character=new L3.DEMONSEDGE.HUD.Character(this.stage,12.5,0),this.endTurn=new L3.DEMONSEDGE.HUD.BUTTONS.EndTurn(this.stage,5,370)},t.prototype.animate=function(){return requestAnimationFrame(this.animate),this.renderer.render(this.stage)},t}(),L3.DEMONSEDGE.HUD.Character=function(){function t(t,e,n){this.parent=t,this.container=new PIXI.Container,this.container.width=75,this.container.position.x=e,this.container.position.y=n,this.picture=new L3.DEMONSEDGE.PIXI.Sprite("character"),this.picture.center(this.container._width),this.container.addChild(this.picture),this.arrows={up:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,25,this.picture.height+0,"up"),left:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,0,this.picture.height+25,"left"),down:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,25,this.picture.height+25,"down"),right:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,50,this.picture.height+25,"right")},this.graphics=new PIXI.Graphics,this.graphics.lineStyle(1,16711680,1),this.graphics.beginFill(3869451,.25),this.graphics.drawRoundedRect(0,0,this.container.width,this.container.height,5),this.graphics.endFill(),this.container.addChild(this.graphics),this.parent.addChild(this.container)}return t}(),L3.DEMONSEDGE.MAP.Map=function(){function t(t){var e;this.de=t,this.cell=this.de.config.map.cell,this.rooms=function(){var t,n,i,r;for(i=this.de.config.map.rooms,r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(new L3.DEMONSEDGE.MAP.Room(this,e));return r}.call(this)}return t.prototype.getX=function(t){var e;return e=t*this.cell.width},t.prototype.getY=function(t){var e;return e=t*this.cell.height},t}(),L3.DEMONSEDGE.MAP.Room=function(){function t(t,e){var n,i,r,s,o,h,a,c,u,p,E;for(this.map=t,this.r=e.r,this.c=e.c,this.rows=e.rows,this.cols=e.cols,this.sprite=new THREE.Object3D,this.cells=[],c=s=0,u=this.rows;u>=0?u>s:s>u;c=u>=0?++s:--s)for(n=o=0,p=this.cols;p>=0?p>o:o>p;n=p>=0?++o:--o)i=new L3.DEMONSEDGE.MAP.Cell(this.map,this.r+c,this.c+n),this.sprite.add(i.sprite),this.cells.push(i);for(this.map.de.env.scene.add(this.sprite),E=this.cells,h=0,a=E.length;a>h;h++)n=E[h],r=new THREE.EdgesHelper(n.sprite,65280),this.map.de.env.scene.add(r)}return t}(),L3.DEMONSEDGE.MAP.Cell=function(){function t(t,e,n){this.r=e,this.c=n,this.sprite=new L3.DEMONSEDGE.THREE.SHAPES.Box(t.cell.width,t.cell.height,t.cell.depth),this.sprite.position.setX(this.c*t.cell.width),this.sprite.position.setY(this.r*t.cell.height)}return t}(),L3.DEMONSEDGE.PIXI.Sprite=function(e){function n(t){var e;e=PIXI.loader.resources[t].texture,n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.rotate=function(t){return("right"===t||"down"===t)&&(this.anchor.y=1),("down"===t||"left"===t)&&(this.anchor.x=1),this.rotation=function(){switch(t){case"right":return 1.57;case"down":return 3.14;case"left":return 4.71;default:return 0}}()},n.prototype.center=function(t){return this.position.x=(t-this.width)/2},n}(PIXI.Sprite),L3.DEMONSEDGE.THREE.Camera=function(e){function n(t,e,i,r){n.__super__.constructor.call(this,t,e,i,r),this.translateX(0),this.translateY(-45),this.translateZ(45),this.zoom=2}return t(n,e),n}(THREE.PerspectiveCamera),L3.DEMONSEDGE.THREE.Controls=function(e){function n(t,e){n.__super__.constructor.call(this,t,e),this.enableDamping=!0,this.dampingFactor=.25,this.enableZoom=!0}return t(n,e),n}(THREE.OrbitControls),L3.DEMONSEDGE.THREE.Environment=function(){function t(t,e){this.updateRendererSize=n(this.updateRendererSize,this),this.init(t,e),this.render()}return t.prototype.init=function(t,e){var n,i;return this.canvas=document.getElementById(e),this.parent=this.canvas.parentNode.parentNode,this.scene=new L3.DEMONSEDGE.THREE.Scene,this.camera=new L3.DEMONSEDGE.THREE.Camera,n=new THREE.AmbientLight(4473924),this.scene.add(n),i=new THREE.PointLight(16777215,1,100),this.scene.add(this.camera),this.camera.add(i),this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,alpha:t,antialiasing:!0}),this.updateRendererSize(),this.controls=new L3.DEMONSEDGE.THREE.Controls(this.camera,this.renderer.domElement),window.addEventListener("resize",this.updateRendererSize,!1),this.applyExtraHtml()},t.prototype.render=function(){return requestAnimationFrame(function(t){return function(){return t.render()}}(this)),TWEEN.update(),this.renderer.render(this.scene,this.camera)},t.prototype.updateRendererSize=function(){return this.size={width:this.parent.offsetWidth-150,height:430},this.camera.aspect=this.size.width/this.size.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.size.width,this.size.height)},t.prototype.applyExtraHtml=function(){return this.canvas.style.backgroundImage="url('resources/img/dev/background.png')"},t}(),L3.DEMONSEDGE.THREE.Group=function(e){function n(t,e){var i,r,s,o;for(this.de=t,this.sprites=e,n.__super__.constructor.call(this),s=this.sprites,i=0,r=s.length;r>i;i++)o=s[i],this.add(o);this.de.env.scene.add(this)}return t(n,e),n}(THREE.Object3D),L3.DEMONSEDGE.THREE.Preload=function(){function t(t){THREE.loader={},this.manager=new THREE.LoadingManager,this.manager.onLoad=t,this.loader=new THREE.TextureLoader(this.manager)}return t.prototype.load=function(t,e){var n,i,r;i=[];for(n in t)r=t[n],console.log(n+" ..."),i.push(this.loadResource(n,r,e));return i},t.prototype.loadResource=function(t,e,n){return THREE.loader[n]={},this.loader.load(e,function(i){return function(i){return console.log("... "+e),THREE.loader[n][t]=i}}(this))},t}(),L3.DEMONSEDGE.THREE.Scene=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.addFromArray=function(t){var e,n,i,r;for(console.log("Adding "+t.length+" objects."),r=[],e=0,n=t.length;n>e;e++)i=t[e],r.push(this.add(i));return r},n}(THREE.Scene),L3.DEMONSEDGE.THREE.SHAPES.Box=function(){function t(t,e,n){var i,r,s;return i=new THREE.BoxGeometry(t,e,n),r=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.Mesh(i,r)}return t}(),L3.DEMONSEDGE.THREE.Sprite=function(e){function n(t){var e,i;i=THREE.loader.textures[t],e=new THREE.SpriteMaterial({map:i,color:16777215,fog:!0}),n.__super__.constructor.call(this,e)}return t(n,e),n}(THREE.Sprite)}).call(this);