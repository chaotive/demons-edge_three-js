(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;RASPE.Animacion=function(){function t(t){this.obj=t}return t.make=function(t){return t.sprite=RASPE.draw.imagen(t,{play:!1,delay:1e3}),t.cleared=!1,t.controller=new RASPE.Animacion(t),t},t.prototype.clear=function(){return APP.debug&&console.log("Clearing "+this.obj.nombre),this.obj.cleared=!0,this.obj.sound.play(),this.obj.sprite.play()},t}(),RASPE.Collision=function(){function t(){}return t.isIntersecting=function(t,e){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)},t}(),RASPE.DrawCanvas=function(){function t(t){this.canvas=t}return t.prototype.imagen=function(t){var e;return e=this.canvas.getContext("2d"),e.drawImage(t.img,t.x,t.y),e},t.prototype.rectangulo=function(t){var e;return e=this.canvas.getContext("2d"),e.fillStyle="#FF"+this._rand()+this._rand()+this._rand()+this._rand(),e.fillRect(t.x,t.y,t.width,t.height),e},t.prototype._rand=function(){return Math.floor(10*Math.random())},t}(),RASPE.DrawPixi=function(){function t(){}return t.imagenes=function(t,e){var o,i,n,r,a;for(n=[],i=r=0,a=t.length;a>r;i=++r)o=t[i],APP.debug&&console.log("img"+i+": "+o.x),o.o=this.imagen(o,e),n.push(o.o),APP.debug&&console.log(o.o);return n},t.imagen=function(t,e){var o,i;return i=new RASPE.DrawPixiSettings(e),(null!=t.frames)>0?(APP.debug&&console.log("animacion"),o=this._animacion(t,i)):(APP.debug&&console.log("imagen"),o=this._imagen(t,i)),i.delay&&(o.visible=!1,o.show=function(){return o.visible=!0},setTimeout(o.show,i.delay)),o},t._imagen=function(t,e){var o,i,n;return n=PIXI.Texture.fromImage(t.img),e.frame?(o=e.frame,n=new PIXI.Texture(n.baseTexture,new PIXI.Rectangle(o.x,o.y,o.width,o.height)),i=new PIXI.Sprite(n),i.position.x=o.x+o.offsetX,i.position.y=o.y+o.offsetY):(i=new PIXI.Sprite(n),i.position.x=t.x,i.position.y=t.y),i},t._animacion=function(t,e){var o,i,n,r,a,s,l,u,c,d;for(APP.debug&&console.log("sp: "+e.play),c=t.img.split("/"),o=c[c.length-1],l=o.split(".")[0],n=[],r=a=0,u=t.frames;u>=0?u>a:a>u;r=u>=0?++a:--a)d=10>r?"0"+r:r,d=100>r?"0"+d:d,d=1e3>r?"0"+d:d,i=l+"/"+d,n.push(PIXI.Texture.fromFrame(i));return s=new PIXI.extras.MovieClip(n),s.position.x=t.x,s.position.y=t.y,e.play&&s.play(),s},t.prototype.rectangulo=function(t){var e;return e=this.canvas.getContext("2d"),e.fillStyle="#FF"+this._rand()+this._rand()+this._rand()+this._rand(),e.fillRect(t.x,t.y,t.width,t.height),e},t.prototype._rand=function(){return Math.floor(10*Math.random())},t}(),RASPE.DrawPixiSettings=function(){function t(t){this.play=null!=(null!=t?t.play:void 0)?t.play:!0,this.frame=null!=(null!=t?t.frame:void 0)?t.frame:!1,this.delay=null!=(null!=t?t.delay:void 0)?t.delay:!1}return t}(),RASPE.Grilla=function(){function t(t){this.obj=t}return t.make=function(t){var e,o,i,n,r,a,s,l,u,c,d,h,g,P;for(APP.debug&&console.log(t),t.controller=new RASPE.Grilla(t),i=t.width/t.columnas,o=t.height/t.filas,APP.debug&&console.log("cw: "+i+" ch: "+o),t.os=[],n=a=0,d=t.filas;d>=0?d>a:a>d;n=d>=0?++a:--a)for(e=s=0,h=t.columnas;h>=0?h>s:s>h;e=h>=0?++s:--s)c=RASPE.GrillaCelda.make(t,e,n,i,o),t.os.push(c);for(APP.debug&&console.log("v"),g=t.os,r=l=0,u=g.length;u>l;r=++l)P=g[r],APP.debug&&console.log(r+": "+P);return t.controller.inactividadReset(),t},t.prototype.inactividadReset=function(){return APP.debug&&console.log(this.obj.inactividad),this.obj.inactividadTo&&clearTimeout(this.obj.inactividadTo),this.obj.inactividadTo=setTimeout(RASPE.juego.perder,1e3*this.obj.inactividad,"No dejes de presionar la pantalla :)")},t}(),RASPE.GrillaCelda=function(){function t(){}return t.make=function(t,e,o,i,n){var r;return r=RASPE.draw.imagen(t,{frame:{x:e*i,y:o*n,offsetX:t.x,offsetY:t.y,width:i,height:n}}),r.interactive=!0,r.col=e,r.fila=o,r.gc=new RASPE.GrillaCelda,r.gc.clicks=t.clicks,r.tap=function(t){return function(t){return APP.debug&&console.log("tap!"),r.gc.click(t)}}(this),r.click=function(t){return function(t){return APP.debug&&console.log("click!"),r.gc.click(t)}}(this),r},t.prototype.click=function(t){var e,o,i;if(APP.debug&&console.log(t),i=t.data.global,o=t.target,RASPE.stage.crearCursor(i.x,i.y),RASPE.sound.cursor.play(),RASPE.data.grilla.controller.inactividadReset(),this.clicks--,o.clickSprite&&RASPE.stage.lNormal.removeChild(o.clickSprite),this.clicks>0){if(o.alpha=this.clicks/RASPE.data.grilla.clicks,RASPE.data.grilla.clickear)return this._clickear(o)}else if(e=RASPE.data.grilla.os.indexOf(o),RASPE.data.grilla.os.splice(e,1),RASPE.stage.lNormal.removeChild(o),RASPE.data.grilla.descubrir&&this._descubrir(o),this._buscarColisiones(RASPE.data.animaciones),0===RASPE.data.grilla.os.length)return RASPE.juego.ganar()},t.prototype._clickear=function(t){var e,o,i;return o=RASPE.data.grilla.clicks-this.clicks,APP.debug&&console.log("clickear:"+o),e=RASPE.data.grilla.clickear[o-1],APP.debug&&console.log(e),e?(i=RASPE.draw.imagen(e),i.x=t.x-(i.width-t.width)/2,i.y=t.y-(i.height-t.height)/2,APP.debug&&console.log(i),t.clickSprite=i,RASPE.stage.lNormal.addChild(i)):void 0},t.prototype._descubrir=function(t){var e,o;return e=RASPE.data.grilla.descubrir,APP.debug&&console.log("descubrir:"),APP.debug&&console.log(e),o=RASPE.draw.imagen(e),o.x=t.x+e.x,o.y=t.y+e.y,o.destroy=function(){return RASPE.stage.lNormal.removeChild(o)},APP.debug&&console.log(o),RASPE.stage.lNormal.addChild(o),setTimeout(o.destroy,e.duracion)},t.prototype._buscarColisiones=function(t){var e,o,i,n,r,a,s,l,u,c,d,h,g;for(u=0,d=[],h=r=0,s=t.length;s>r;h=++r)if(e=t[h],e.cleared===!1){for(APP.debug&&console.log(e),APP.debug&&console.log(e.x+", "+e.y),u++,o=e.sprite,APP.debug&&console.log("animacion"+h+": "+o.x+", "+o.y+", "+o.width+", "+o.height+", Colisiones:"),n=0,c=RASPE.data.grilla.os,g=a=0,l=c.length;l>a;g=++a)i=c[g],RASPE.Collision.isIntersecting(i,o)&&(n++,APP.debug&&console.log("celda"+g+"["+i.fila+", "+i.col+"]: "+i.x+", "+i.y+", "+i.width+", "+i.height));APP.debug&&console.log(n),0===n?(e.controller.clear(),d.push(u--)):d.push(void 0)}return d},t}(),RASPE.Juego=function(){function t(t){this.stop(),this.stageNum=t,RASPE.data=RASPE.datas[this.stageNum-1],RASPE.draw=RASPE.DrawPixi,RASPE.sound=new RASPE.Sound,RASPE.juego=this,RASPE.cont=document.getElementById("juego"),RASPE.renderer=this._createRenderer(RASPE.cont,RASPE.data.config.width,RASPE.data.config.height),RASPE.stage=new RASPE.Stage}return t.prototype.stop=function(){var t,e,o;return null!=(t=RASPE.sound)&&t.music.stop(),(null!=(e=RASPE.data)?e.reloj.to:void 0)&&clearTimeout(RASPE.data.reloj.to),(null!=(o=RASPE.data)?o.grilla.inactividadTo:void 0)?clearTimeout(RASPE.data.grilla.inactividadTo):void 0},t.prototype._createRenderer=function(t,e,o){var i;return $("#"+t.id).empty(),i=PIXI.autoDetectRenderer(e,o,{backgroundColor:1087931}),i.autoResize=!0,t.appendChild(i.view),i},t.prototype.ganar=function(t){return null==t&&(t=""),RASPE.juego.stop(),console.log("Ganaste!\n"+t),ganar(t,this.stageNum)},t.prototype.perder=function(t){return null==t&&(t=""),RASPE.juego.stop(),console.log("Perdiste!\n"+t),perder(t,this.stageNum)},t}(),RASPE.Preload=function(){function t(){this.as=[]}return t.prototype.parseDraws=function(t){var e,o,i,n,r,a,s,l,u,c;for(l=this._parseImg(t.fondo),o=0,r=l.length;r>o;o++)e=l[o],this._push(this.as,e);for(this._push(this.as,t.cursor.img),u=this._parseImg(t.animaciones),i=0,a=u.length;a>i;i++)e=u[i],this._push(this.as,e);if(this._push(this.as,t.grilla.img),t.grilla.descubrir&&this._push(this.as,t.grilla.descubrir.img),t.grilla.clickear)for(c=this._parseImg(t.grilla.clickear),n=0,s=c.length;s>n;n++)e=c[n],this._push(this.as,e);return APP.debug?console.log(this.as):void 0},t.prototype._parseImg=function(t){var e,o,i,n;for(o=[],i=0,n=t.length;n>i;i++)e=t[i],o.push(e.img);return o},t.prototype._push=function(t,e){return-1===t.indexOf(e)?t.push(e):void 0},t.load=function(t,e){var o,i,n,r,a;for(console.log("Preloading..."),RASPE.datas=[],n=new RASPE.Preload,this.q=[],r=[],o=0,i=t.length;i>o;o++)a=t[o],r.push(a),this.q.push(function(){return $.getJSON(r.shift(),function(t){return n.parseDraws(t),RASPE.datas.push(t),RASPE.Preload.q.shift()()})});return this.q.push(function(){return APP.debug&&console.log("debug"),RASPE.Preload.q.shift()()}),this.q.push(function(){return APP.debug&&console.log("Filling PIXI"),APP.debug&&console.log(n.as),PIXI.loader.add(n.as).load(e)}),this.q.shift()()},t}(),RASPE.Reloj=function(){function e(e){this.disminuir=t(this.disminuir,this),this.obj=e,this.disminuir(this.obj.tiempo)}return e.make=function(t){return t.sprite=new PIXI.Text(t.tiempo,t.style),null!=t.x?t.sprite.x=t.x:t.sprite.x=RASPE.renderer.width/2-t.sprite.width/2,t.y&&(t.sprite.y=t.y),t.controller=new RASPE.Reloj(t),t},e.prototype.disminuir=function(t){var e,o,i;return APP.debug&&console.log("Disminuyendo "+t),e=Math.floor(t/60),o=t-60*e,i=this._fixZero(e)+":"+this._fixZero(o),this.obj.sprite.text=i,0===t?RASPE.juego.perder():this.obj.to=setTimeout(this.disminuir,1e3,t-1)},e.prototype._fixZero=function(t){return t>9?t:"0"+t},e}(),RASPE.Sound=function(){function t(){this.renderer=new RASPE.SoundHowler,this.music=this.renderer.music(RASPE.data.config.music_src),this.cursor=this.renderer.sound(RASPE.data.cursor.sound_src),this._generarAnimaciones(RASPE.data.animaciones)}return t.prototype._generarAnimaciones=function(t){var e,o,i,n;for(n=[],o=0,i=t.length;i>o;o++)e=t[o],n.push(e.sound=this.renderer.sound(e.sound_src));return n},t}(),RASPE.SoundHowler=function(){function t(){}return t.prototype.music=function(t){var e;return e=new Howl({urls:[t,t.substr(0,-3)+"ogg"],buffer:!0,loop:!0,onload:function(){return APP.debug?console.log("Loaded "+t):void 0},onplay:function(){return APP.debug?console.log("Now playing "+t):void 0}})},t.prototype.sound=function(t){var e;return e=new Howl({urls:[t,t.substr(0,-3)+"ogg"],loop:!1,onload:function(){return APP.debug?console.log("Loaded "+t):void 0},onplay:function(){return APP.debug?console.log("Now playing "+t):void 0}})},t}(),RASPE.Stage=function(o){function i(e){this.animate=t(this.animate,this),i.__super__.constructor.call(this),this.lNormal=new PIXI.Container,this.lReloj=new PIXI.Container,this.addChild(this.lNormal),this.addChild(this.lReloj),this._dibujar(),this._sonar(),this.animate()}return e(i,o),i.prototype.animate=function(){return requestAnimationFrame(this.animate),RASPE.renderer.render(this)},i.prototype._dibujar=function(){var t,e,o,i;for(i=RASPE.draw.imagenes(RASPE.data.fondo),e=0,o=i.length;o>e;e++)t=i[e],this.lNormal.addChild(t);return this._crearAnimaciones(RASPE.data.animaciones),this._crearGrilla(RASPE.data.grilla),this._crearReloj(RASPE.data.reloj)},i.prototype._sonar=function(){return RASPE.sound.music.play()},i.prototype._crearReloj=function(t){return this.lReloj.addChild(RASPE.Reloj.make(t).sprite)},i.prototype._crearAnimaciones=function(t){var e,o,i,n;for(n=[],o=0,i=t.length;i>o;o++)e=t[o],n.push(this.lNormal.addChild(RASPE.Animacion.make(e).sprite));return n},i.prototype._crearGrilla=function(t){var e,o,i,n,r;for(o=RASPE.Grilla.make(t).os,r=[],i=0,n=o.length;n>i;i++)e=o[i],r.push(this.lNormal.addChild(e));return r},i.prototype.crearCursor=function(t,e){var o,i;return o=RASPE.data.cursor,APP.debug&&console.log("cursor: "+o),i=RASPE.draw.imagen(o),i.x=t-i.width/2,i.y=e-i.height/2,i.destroy=function(t){return t.lNormal.removeChild(i)},APP.debug&&console.log(i),this.lNormal.addChild(i),setTimeout(i.destroy,o.duracion,this)},i}(PIXI.Container)}).call(this);