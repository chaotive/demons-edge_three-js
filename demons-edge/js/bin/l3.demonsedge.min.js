(function(){var t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=function(t,e){return function(){return t.apply(e,arguments)}};L3.DEMONSEDGE.CHARACTERS.Base=function(){function t(t,e,i,n){this.g=t,this.row=e,this.col=i,this.sprite=this.addSprite(this.g,this.row,this.col,n),this.g.env.scene.add(this.sprite),this.moving=new L3.DEMONSEDGE.GAME.Move(this),this.actionsPerTurn=1,this.actions=this.actionsPerTurn,this.speed=1}return t.prototype.addSprite=function(t,e,i,n){var r;return r=new L3.DEMONSEDGE.THREE.Sprite(n),r.position.setX(i*t.map.cell.width),r.position.setY(e*t.map.cell.height),r.position.setZ(t.map.cell.depth),r},t.prototype.moveRel=function(t,e){return console.log("Attempting move: "+t+" "+e),this.move(this.row+t*this.speed,this.col+e*this.speed)},t.prototype.move=function(t,e){var i,n,r;return!this.moving.is()&&this.actions?(this.moving.set(!0),this.row=t,this.col=e,this.actions--,i={x:this.sprite.position.x,y:this.sprite.position.y},n={x:this.g.map.getX(e),y:this.g.map.getY(t)},r=new TWEEN.Tween(i).to(n,500),r.onUpdate(function(t){return function(){return t.sprite.position.x=i.x,t.sprite.position.y=i.y}}(this)),r.onComplete(function(t){return function(){return t.moving.set(!1),console.log("Finished move: "+t.row+" "+t.col)}}(this)),r.start()):this.actions?console.warn("Can't move, already moving?"):console.warn("No actions available!")},t.prototype.turnReset=function(){return this.actions=this.actionsPerTurn,console.log(this.actions+" "+this.actionsPerTurn)},t}(),L3.DEMONSEDGE.CHARACTERS.Enemy=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i}(L3.DEMONSEDGE.CHARACTERS.Base),L3.DEMONSEDGE.CHARACTERS.Player=function(e){function n(t,e,r,o){this.g=t,this.row=e,this.col=r,this.onClick=i(this.onClick,this),n.__super__.constructor.call(this,this.g,this.row,this.col,o),this.actionsPerTurn=2,this.actions=this.actionsPerTurn,this.speed=2}return t(n,e),n.prototype.onClick=function(t){return console.log(t),this.createMenu()},n.prototype.createMenu=function(){return console.log("creating menu...")},n.prototype.animIdle=function(){},n}(L3.DEMONSEDGE.CHARACTERS.Base),L3.DEMONSEDGE.DemonsEdge=function(){function t(){this.create=i(this.create,this),this.preloadPixi=i(this.preloadPixi,this),this.preload=i(this.preload,this),console.log("Welcome to DemonsEdge"),loadJSON("resources/config/dev/test.json",["config"],this.preload)}return t.prototype.preload=function(){var t;return console.log("Preloading three.js..."),t=new L3.DEMONSEDGE.THREE.Preload(function(t){return function(){return console.log("... preload finished!"),t.preloadPixi()}}(this)),this.ress=t.ress,t.load({sample1:"resources/img/dev/sample1.png",enemy1:"resources/img/dev/enemy1.png",char1:"resources/anim/char1/idle.png"},"textures"),t.load({background:"resources/img/dev/background.png"},"imgs")},t.prototype.preloadPixi=function(){var t,e,i,n;console.log("Preloading pixi.js..."),i=PIXI.loader,e={arrow:"resources/img/dev/hud/key-board-arrow-border.png",endTurn:"resources/img/dev/hud/end-turn.png",character:"resources/img/dev/sample1.png"};for(t in e)n=e[t],console.log(t),i.add(t,n);return i.once("complete",function(t){return function(){return console.log("... preload finished!"),t.create()}}(this)),i.load()},t.prototype.create=function(){return this.createConfig(config),this.createEnvironment(),this.moving=new L3.DEMONSEDGE.GAME.MoveGlobal,this.turns=new L3.DEMONSEDGE.GAME.Turn(this)},t.prototype.createConfig=function(t){return RDG.Dungeon.Generate(),t.map.rooms=RDG.Dungeon.rooms.map(function(t){return{r:t.x,c:t.y,rows:t.w,cols:t.h}}),this.config=t},t.prototype.createEnvironment=function(){return this.hud=new L3.DEMONSEDGE.HUD.Hud(this,100,430,{view:document.getElementById("game-hud")}),this.env=new L3.DEMONSEDGE.THREE.Environment(!0,"game-scene"),this.map=new L3.DEMONSEDGE.MAP.Map(this),this.player=new L3.DEMONSEDGE.CHARACTERS.Player(this,0,0,"char1"),this.enemy=new L3.DEMONSEDGE.CHARACTERS.Enemy(this,1,2,"enemy1"),this.createGroups()},t.prototype.createGroups=function(){var t;return this.sg1=new L3.DEMONSEDGE.THREE.Group(this,function(){var e,i,n,r;for(n=this.map.rooms,r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(t.sprite);return r}.call(this).concat([this.player.sprite,this.enemy.sprite])),this.sg1.translateX(0),this.sg1.translateZ(-15)},t}(),L3.DEMONSEDGE.GAME.Actions=function(){function t(){console.log("Hi :)")}return t}(),L3.DEMONSEDGE.GAME.Move=function(){function t(t){this.obj=t,this.g=this.obj.g,this.state=!1}return t.prototype.set=function(t){return this.state=t,this.state?this.g.moving.add(this):this.g.moving.remove(this)},t.prototype.is=function(){return this.state},t}(),L3.DEMONSEDGE.GAME.MoveGlobal=function(){function t(){this.objs=[]}return t.prototype.add=function(t){return this.objs.push(t)},t.prototype.remove=function(t){var e;return e=this.objs.indexOf(t),this.objs.splice(e,1)},t.prototype.is=function(){return 0===this.objs.length},t}(),L3.DEMONSEDGE.GAME.Turn=function(){function t(t){this.de=t,this.number=0,this.newTurn()}return t.prototype.advance=function(){return this.de.moving.is()?(this.moveEnemies(),this.newTurn()):console.warn("Still moving!")},t.prototype.moveEnemies=function(){var t;return t=CHAOTIVE.UTIL.Random,this.de.enemy.moveRel(t.number(1,-1),t.number(1,-1))},t.prototype.newTurn=function(){return this.de.player.turnReset(),this.de.enemy.turnReset(),this.number++,console.log("Beginning turn "+this.number)},t}(),L3.DEMONSEDGE.GUI.Button=function(){function t(){}return t}(),L3.DEMONSEDGE.HUD.BUTTONS.Arrow=function(e){function i(t,e,i,n){this.parent=t,this.direction=n,this.sprite=new L3.DEMONSEDGE.PIXI.Sprite("arrow"),this.sprite.width=25,this.sprite.height=25,this.sprite.position.x=e,this.sprite.position.y=i,this.sprite.rotate(this.direction),this.sprite.interactive=!0,this.sprite.on("mousedown",function(t){return function(){return t.action(t.direction)}}(this)),this.sprite.on("touchstart",function(t){return function(){return t.action(t.direction)}}(this)),this.parent.addChild(this.sprite)}return t(i,e),i.prototype.action=function(t){switch(t){case"left":return L3.de.player.moveRel(0,-1);case"right":return L3.de.player.moveRel(0,1);case"up":return L3.de.player.moveRel(1,0);case"down":return L3.de.player.moveRel(-1,0)}},i}(L3.DEMONSEDGE.GUI.Button),L3.DEMONSEDGE.HUD.BUTTONS.EndTurn=function(e){function i(t,e,i){this.parent=t,this.sprite=new L3.DEMONSEDGE.PIXI.Sprite("endTurn"),this.sprite.width=90,this.sprite.height=60,this.sprite.position.x=e,this.sprite.position.y=i,this.sprite.interactive=!0,this.sprite.on("mousedown",function(t){return function(){return t.action()}}(this)),this.sprite.on("touchstart",function(t){return function(){return t.action()}}(this)),this.parent.addChild(this.sprite)}return t(i,e),i.prototype.action=function(){return L3.de.turns.advance()},i}(L3.DEMONSEDGE.GUI.Button),L3.DEMONSEDGE.HUD.Hud=function(){function t(t,e,n,r){this.g=t,null==r&&(r={}),this.animate=i(this.animate,this),r.transparent=!0,this.renderer=new PIXI.CanvasRenderer(e,n,r),this.renderer.autoResize=!0,this.stage=new PIXI.Container,this.create(),this.animate()}return t.prototype.create=function(){return this.graphics=new PIXI.Graphics,this.graphics.lineStyle(1,16711680,1),this.graphics.beginFill(3869451,.25),this.graphics.drawRoundedRect(0,0,this.renderer.width,this.renderer.height,5),this.graphics.endFill(),this.stage.addChild(this.graphics),this.character=new L3.DEMONSEDGE.HUD.Character(this.stage,12.5,0),this.endTurn=new L3.DEMONSEDGE.HUD.BUTTONS.EndTurn(this.stage,5,370)},t.prototype.animate=function(){return requestAnimationFrame(this.animate),this.renderer.render(this.stage)},t}(),L3.DEMONSEDGE.HUD.Character=function(){function t(t,e,i){this.parent=t,this.container=new PIXI.Container,this.container.width=75,this.container.position.x=e,this.container.position.y=i,this.picture=new L3.DEMONSEDGE.PIXI.Sprite("character"),this.picture.center(this.container._width),this.container.addChild(this.picture),this.arrows={up:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,25,this.picture.height+0,"up"),left:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,0,this.picture.height+25,"left"),down:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,25,this.picture.height+25,"down"),right:new L3.DEMONSEDGE.HUD.BUTTONS.Arrow(this.container,50,this.picture.height+25,"right")},this.graphics=new PIXI.Graphics,this.graphics.lineStyle(1,16711680,1),this.graphics.beginFill(3869451,.25),this.graphics.drawRoundedRect(0,0,this.container.width,this.container.height,5),this.graphics.endFill(),this.container.addChild(this.graphics),this.parent.addChild(this.container)}return t}(),L3.DEMONSEDGE.MAP.Map=function(){function t(t){var e;this.de=t,this.cell=this.de.config.map.cell,this.rooms=function(){var t,i,n,r;for(n=this.de.config.map.rooms,r=[],t=0,i=n.length;i>t;t++)e=n[t],r.push(new L3.DEMONSEDGE.MAP.Room(this,e));return r}.call(this)}return t.prototype.getX=function(t){var e;return e=t*this.cell.width},t.prototype.getY=function(t){var e;return e=t*this.cell.height},t}(),L3.DEMONSEDGE.MAP.Room=function(){function t(t,e){var i,n,r,o,s,h,a,c,u,p,E;for(this.map=t,this.r=e.r,this.c=e.c,this.rows=e.rows,this.cols=e.cols,this.sprite=new THREE.Object3D,this.cells=[],c=o=0,u=this.rows;u>=0?u>o:o>u;c=u>=0?++o:--o)for(i=s=0,p=this.cols;p>=0?p>s:s>p;i=p>=0?++s:--s)n=new L3.DEMONSEDGE.MAP.Cell(this.map,this.r+c,this.c+i),this.sprite.add(n.sprite),this.cells.push(n);for(this.map.de.env.scene.add(this.sprite),E=this.cells,h=0,a=E.length;a>h;h++)i=E[h],r=new THREE.EdgesHelper(i.sprite,65280),this.map.de.env.scene.add(r)}return t}(),L3.DEMONSEDGE.MAP.Cell=function(){function t(t,e,i){this.r=e,this.c=i,this.sprite=new L3.DEMONSEDGE.THREE.SHAPES.Box(t.cell.width,t.cell.height,t.cell.depth),this.sprite.position.setX(this.c*t.cell.width),this.sprite.position.setY(this.r*t.cell.height)}return t}(),L3.DEMONSEDGE.PIXI.Sprite=function(e){function i(t){var e;e=PIXI.loader.resources[t].texture,i.__super__.constructor.call(this,e)}return t(i,e),i.prototype.rotate=function(t){return("right"===t||"down"===t)&&(this.anchor.y=1),("down"===t||"left"===t)&&(this.anchor.x=1),this.rotation=function(){switch(t){case"right":return 1.57;case"down":return 3.14;case"left":return 4.71;default:return 0}}()},i.prototype.center=function(t){return this.position.x=(t-this.width)/2},i}(PIXI.Sprite),L3.DEMONSEDGE.THREE.SimpleCamera=function(e){function i(t,e,n,r){null==r&&(r={}),i.__super__.constructor.call(this),this.position.x=10,this.position.y=9,this.position.z=-12,this.rotation.x=1.25,this.rotation.y=.7,this.rotation.z=.2}return t(i,e),i.prototype.updateAspect=function(t,e){return this.left=t/-40,this.right=t/40,this.top=e/40,this.bottom=e/-40,this.near=-1e3,this.far=1e3},i.prototype.updatePosition=function(t,e){return this.position[t]+=e,$("#position-debug").text(this.position.x+" "+this.position.y+" "+this.position.z)},i.prototype.updateRotation=function(t,e){var i;return i=function(t){return t.toString().substring(0,5)},this.rotation[t]+=e/20,$("#rotation-debug").text(i(this.rotation.x)+" "+i(this.rotation.y)+" "+i(this.rotation.z))},i.prototype.updateZoom=function(t){var e;return e=function(t){return t.toString().substring(0,3)},this.zoom+=t/10,$("#zoom-debug").text(e(this.zoom)),this.updateProjectionMatrix()},i}(THREE.OrthographicCamera),L3.DEMONSEDGE.THREE.ControlCamera=function(e){function i(t,e,n,r,o,s){var h;this.renderer=t,null==s&&(s={}),i.__super__.constructor.call(this,s.fov,s.aspect,s.near,s.far),this.translateX(e),this.translateY(n),this.translateZ(r),this.zoom=o,h=new THREE.PointLight(16777215,1,100),this.add(h),this.controls=new L3.DEMONSEDGE.THREE.Controls(this,this.renderer.domElement),this.controls.enabled=!0}return t(i,e),i.prototype.updateAspect=function(t,e){return this.aspect=t/e},i}(THREE.PerspectiveCamera),L3.DEMONSEDGE.THREE.Controls=function(e){function i(t,e){i.__super__.constructor.call(this,t,e),this.enableDamping=!0,this.dampingFactor=.25,this.enableZoom=!0}return t(i,e),i}(THREE.OrbitControls),L3.DEMONSEDGE.THREE.Environment=function(){function t(t,e){this.updateRendererSize=i(this.updateRendererSize,this),this.init(t,e),this.render()}return t.prototype.init=function(t,e){var i;return this.canvas=document.getElementById(e),this.parent=this.canvas.parentNode.parentNode,this.scene=new L3.DEMONSEDGE.THREE.Scene,this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,alpha:t,antialiasing:!0}),this.setSize(),this.camera=new L3.DEMONSEDGE.THREE.SimpleCamera(this.size.width,this.size.height),this.scene.add(this.camera),this.updateRendererSize(),i=new THREE.AmbientLight(4473924),this.scene.add(i),this.applyExtraHtml(),window.addEventListener("resize",this.updateRendererSize,!1)},t.prototype.render=function(){return requestAnimationFrame(function(t){return function(){return t.render()}}(this)),TWEEN.update(),this.renderer.render(this.scene,this.camera)},t.prototype.setSize=function(){return this.size={width:this.parent.offsetWidth-150,height:430}},t.prototype.updateRendererSize=function(){return this.setSize(),this.camera.updateAspect(this.size.width,this.size.height),this.camera.updateProjectionMatrix(),this.renderer.setSize(this.size.width,this.size.height)},t.prototype.applyExtraHtml=function(){return this.canvas.style.backgroundImage="url('resources/img/dev/background.png')"},t}(),L3.DEMONSEDGE.THREE.Group=function(e){function i(t,e){var n,r,o,s;for(this.de=t,this.sprites=e,i.__super__.constructor.call(this),o=this.sprites,n=0,r=o.length;r>n;n++)s=o[n],this.add(s);this.de.env.scene.add(this)}return t(i,e),i}(THREE.Object3D),L3.DEMONSEDGE.THREE.Preload=function(){function t(t){THREE.loader={},this.manager=new THREE.LoadingManager,this.manager.onLoad=t,this.loader=new THREE.TextureLoader(this.manager)}return t.prototype.load=function(t,e){var i,n,r;n=[];for(i in t)r=t[i],console.log(i+" ..."),n.push(this.loadResource(i,r,e));return n},t.prototype.loadResource=function(t,e,i){return THREE.loader[i]={},this.loader.load(e,function(n){return function(n){return console.log("... "+e),THREE.loader[i][t]=n}}(this))},t}(),L3.DEMONSEDGE.THREE.Scene=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.addFromArray=function(t){var e,i,n,r;for(console.log("Adding "+t.length+" objects."),r=[],e=0,i=t.length;i>e;e++)n=t[e],r.push(this.add(n));return r},i}(THREE.Scene),L3.DEMONSEDGE.THREE.SHAPES.Box=function(){function t(t,e,i){var n,r,o;return n=new THREE.BoxGeometry(t,e,i),r=new THREE.MeshBasicMaterial({color:16711680}),o=new THREE.Mesh(n,r)}return t}(),L3.DEMONSEDGE.THREE.Sprite=function(e){function i(t){var e;this.texture=THREE.loader.textures[t],e=new THREE.SpriteMaterial({map:this.texture,color:16777215,fog:!0}),i.__super__.constructor.call(this,e)}return t(i,e),i}(THREE.Sprite)}).call(this);